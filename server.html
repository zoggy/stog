<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="application/xhtml+xml; charset=utf-8" http-equiv="Content-Type"/>
<title>Stog : Preview server</title>
<link href="https://zoggy.github.io/stog/style.css" rel="stylesheet" type="text/css"/>
</head>
<script type="text/javascript">
function submitSearch(){
    var q = document.getElementById('q');
    q.value =q.value + " site:https://zoggy.github.io/stog ";
    return true;
}
</script>
<body>
<div id="page">
<div class="navbar navbar-fixed-top">
<div class="navbar-inner">
<div class="container">

<!--&lt;image float="right" src="&lt;site-url/&gt;/stog-logo.svg" width="30"/&gt;-->

  <div class="nav-collapse">
    <ul class="nav">
    <li class="&lt;navbar-home/&gt;"><a href="https://zoggy.github.io/stog/index.html">Stog</a></li>
    <li class="&lt;navbar-install/&gt;"><a href="https://zoggy.github.io/stog/install.html">Installation</a></li>
    <li class="active"><a href="https://zoggy.github.io/stog/doc.html">Documentation</a></li>
    <li class="&lt;navbar-plugins/&gt;"><a href="https://zoggy.github.io/stog/plugins.html">Plugins</a></li>
    <li class="&lt;navbar-blog/&gt;"><a href="https://zoggy.github.io/stog/blog.html">Blog</a></li>
    <li class="&lt;navbar-about/&gt;"><a href="https://zoggy.github.io/stog/about.html">?</a></li>
    </ul>
<!--
    &lt;div class="nav pull-right"&gt;
       &lt;form action="https://qwant.com/" method="GET"
         onsubmit="submitSearch();"
         style="overflow:hidden;margin:0;margin-top:5px;padding:0;height:28px;display:flex;"
         frameborder="0"&gt;
         &lt;input style="width: 100px;" type="text" id="q" placeHolder="Search" name="q"/&gt;
         &lt;input style="font-size: 0.8em" type="submit" value="ðŸ”Ž"/&gt;
       &lt;/form&gt;
    &lt;/div&gt;
-->
  </div>

</div>
</div>
</div>

<div id="header">
  
  
  
  <div class="page-title">Preview server</div>
</div>




<toc-contents></toc-contents>
<div class="section"><div aria-level="1" class="section-title" id="whatis" role="heading">What is this ?</div>
<p>
The preview server watches Stog files and recomputes
the documents when there is a change. This is useful to have
a preview as you modify your web site or article.
</p>
<p>Have a look at stog server in action on a video
<a href="https://zoggy.github.io/stog/posts/2014-10-27-video.html">here</a>.
</p>
</div>

<div class="section"><div aria-level="1" class="section-title" id="how" role="heading">How does it work ?</div>
<p>
When launched, the server computes the documents a first time.
It then handles HTTP connections. All documents are accessed
under the path <span class="icode"><span class="hl std">/preview/</span></span>. For example, the <span class="icode"><span class="hl std">/foo/bar.html</span></span>
document will be browsed, by default, at address
<span class="icode"><span class="hl std">http://localhost:8080/preview/foo/bar.html</span></span>.
</p>
<p>
When a browser queries a document preview, the server returns
a simple page with some javascript code to load. This javascript code
opens a websocket connection, by default to <span class="icode"><span class="hl std">http://localhost:8081</span></span>,
and queries the document. The server sends the whole document preview and
the javascript code fills the DOM with the document.
</p>
<p>
When a source file is modified, the server recomputes
the corresponding documents and sends a patch to the browser,
through the websocket connection.
The javascript code applies the patch to the DOM.
</p>
<p>
Applying patches rather than reloading the whole document is better
when some parts of the document are changed by some other code
(I'm looking at you, Mathjax). By now, this case is not fully handled yet,
but this is work in progress. The javascript part of
the <span class="ext-a"><a href="http://zoggy.github.io/xmldiff">Xmldiff</a></span>
library allows to specify some nodes to ignore when applying a patch.
</p>
<p class="alert alert-warning">
By now, only documents which exist when the server is launched are
watched for changes. This means that if you add a new document source file,
you have to click on the â†º button at the top of the preview page.
</p>
</div>

<div class="section"><div aria-level="1" class="section-title" id="usage" role="heading">Usage</div>
<p>
To run the server, simply run <span class="icode"><span class="hl std">stog-server[.byte]</span></span> instead of
<span class="icode"><span class="hl std">stog[.byte]</span></span>, with the same parameters.
</p>
<p>
You can use <span class="icode"><span class="hl std">mk-stog[.byte]</span></span> to create your own server. To do
so, just use <span class="icode"><span class="hl std">--package stog.server</span></span> in addition to other packages.
</p>
<p>
The <span class="icode"><span class="hl std">--http</span></span> and <span class="icode"><span class="hl std">--ws</span></span> command line options can be
used to specify a url defining the host and port to listen on, for the HTTP
and websocket servers respectively. Defaults are <span class="icode"><span class="hl std">http://localhost:8080</span></span>
and <span class="icode"><span class="hl std">ws://localhost:8081</span></span>.
</p>
<p>If the server must be run behind a proxy, you must also give the
<span class="icode"><span class="hl std">--pub-http</span></span> and <span class="icode"><span class="hl std">--pub-ws</span></span> options to indicate
the "public" base urls, i.e. the ones that the proxy will handle to send
queries to the server.
</p>
</div>






<p class="doccode alert alert-info">
For information you can see the <a href="#pagesource"> source code of the page</a>.
</p>
<div id="pagesource">
  <pre class="code-xml"><span class="hl kwa">&lt;page</span><span class="hl std"> </span><span class="">title</span><span class="hl std">=</span><span class="hl str">"Preview server"</span><span class="hl std">
</span><span class="">with-contents</span><span class="hl std">=</span><span class="hl str">"true"</span><span class="hl std">
</span><span class="">navbar-doc</span><span class="hl std">=</span><span class="hl str">"active"</span><span class="hl std">
</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;contents</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;toc</span><span class="hl kwa">/&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;section</span><span class="hl std"> </span><span class="">id</span><span class="hl std">=</span><span class="hl str">"whatis"</span><span class="hl std"> </span><span class="">title</span><span class="hl std">=</span><span class="hl str">"What is this ?"</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;p</span><span class="hl kwa">&gt;</span><span class="hl std">
The preview server watches Stog files and recomputes
the documents when there is a change. This is useful to have
a preview as you modify your web site or article.
</span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;p</span><span class="hl kwa">&gt;</span><span class="hl std">Have a look at stog server in action on a video
</span><span class="hl kwa">&lt;doc</span><span class="hl std"> </span><span class="">href</span><span class="hl std">=</span><span class="hl str">"2014-10-27-video.html"</span><span class="hl kwa">&gt;</span><span class="hl std">here</span><span class="hl kwa">&lt;/doc</span><span class="hl kwa">&gt;</span><span class="hl std">.
</span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;/section</span><span class="hl kwa">&gt;</span><span class="hl std">

</span><span class="hl kwa">&lt;section</span><span class="hl std"> </span><span class="">id</span><span class="hl std">=</span><span class="hl str">"how"</span><span class="hl std"> </span><span class="">title</span><span class="hl std">=</span><span class="hl str">"How does it work ?"</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;p</span><span class="hl kwa">&gt;</span><span class="hl std">
When launched, the server computes the documents a first time.
It then handles HTTP connections. All documents are accessed
under the path </span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">/preview/</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std">. For example, the </span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">/foo/bar.html</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std">
document will be browsed, by default, at address
</span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">http://localhost:8080/preview/foo/bar.html</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std">.
</span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;p</span><span class="hl kwa">&gt;</span><span class="hl std">
When a browser queries a document preview, the server returns
a simple page with some javascript code to load. This javascript code
opens a websocket connection, by default to </span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">http://localhost:8081</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std">,
and queries the document. The server sends the whole document preview and
the javascript code fills the DOM with the document.
</span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;p</span><span class="hl kwa">&gt;</span><span class="hl std">
When a source file is modified, the server recomputes
the corresponding documents and sends a patch to the browser,
through the websocket connection.
The javascript code applies the patch to the DOM.
</span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;p</span><span class="hl kwa">&gt;</span><span class="hl std">
Applying patches rather than reloading the whole document is better
when some parts of the document are changed by some other code
(I'm looking at you, Mathjax). By now, this case is not fully handled yet,
but this is work in progress. The javascript part of
the </span><span class="hl kwa">&lt;ext-a</span><span class="hl std"> </span><span class="">href</span><span class="hl std">=</span><span class="hl str">"http://zoggy.github.io/xmldiff"</span><span class="hl kwa">&gt;</span><span class="hl std">Xmldiff</span><span class="hl kwa">&lt;/ext-a</span><span class="hl kwa">&gt;</span><span class="hl std">
library allows to specify some nodes to ignore when applying a patch.
</span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;p</span><span class="hl std"> </span><span class="">class</span><span class="hl std">=</span><span class="hl str">"alert alert-warning"</span><span class="hl kwa">&gt;</span><span class="hl std">
By now, only documents which exist when the server is launched are
watched for changes. This means that if you add a new document source file,
you have to click on the â†º button at the top of the preview page.
</span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;/section</span><span class="hl kwa">&gt;</span><span class="hl std">

</span><span class="hl kwa">&lt;section</span><span class="hl std"> </span><span class="">id</span><span class="hl std">=</span><span class="hl str">"usage"</span><span class="hl std"> </span><span class="">title</span><span class="hl std">=</span><span class="hl str">"Usage"</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;p</span><span class="hl kwa">&gt;</span><span class="hl std">
To run the server, simply run </span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">stog-server[.byte]</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std"> instead of
</span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">stog[.byte]</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std">, with the same parameters.
</span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;p</span><span class="hl kwa">&gt;</span><span class="hl std">
You can use </span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">mk-stog[.byte]</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std"> to create your own server. To do
so, just use </span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">--package stog.server</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std"> in addition to other packages.
</span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;p</span><span class="hl kwa">&gt;</span><span class="hl std">
The </span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">--http</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std"> and </span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">--ws</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std"> command line options can be
used to specify a url defining the host and port to listen on, for the HTTP
and websocket servers respectively. Defaults are </span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">http://localhost:8080</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std">
and </span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">ws://localhost:8081</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std">.
</span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;p</span><span class="hl kwa">&gt;</span><span class="hl std">If the server must be run behind a proxy, you must also give the
</span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">--pub-http</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std"> and </span><span class="hl kwa">&lt;icode</span><span class="hl kwa">&gt;</span><span class="hl std">--pub-ws</span><span class="hl kwa">&lt;/icode</span><span class="hl kwa">&gt;</span><span class="hl std"> options to indicate
the "public" base urls, i.e. the ones that the proxy will handle to send
queries to the server.
</span><span class="hl kwa">&lt;/p</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;/section</span><span class="hl kwa">&gt;</span><span class="hl std">

</span><span class="hl kwa">&lt;/contents</span><span class="hl kwa">&gt;</span><span class="hl std">
</span><span class="hl kwa">&lt;/page</span><span class="hl kwa">&gt;</span></pre>
</div>


<div id="footer">
<div class="generatedon">Generated on May 3, 2017 at 9h20</div>
</div>
<!--&lt;script type="text/javascript" src="&lt;site-url/&gt;/jquery.js"&gt;_&lt;/script&gt;-->
<!--&lt;script type="text/javascript" src="&lt;site-url/&gt;/bootstrap-collapse.js"&gt;_&lt;/script&gt;-->

</div> <!-- #page -->
</body>
</html>
